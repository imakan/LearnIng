# 问在平时工作中遇到的nodejs优化问题

1、比如要使用lts的版本
2、我们用用到的JSON.stringify(),其实这个方法，很耗性能，特别是对象层级比较深的时候，使用fast-json-stringify
3、promise的性能，比如用blue-bird
4、比如我们经常使用一些await的时候，其实用promise.all，或者an(规范写的是race)包装起来，这种风格能给我们带来很大的性能提升
5、新生代，老生代的问题。
先说一下老生代，在平时我们编码的时候，要获取一个用户的id的话，往往我们会把这个id 缓存起来，随着时间的推移，这个对象会越来越大，那这个就造成了，GC回收的时候，时间太长，GC是三色标记和BFS的方式回收的，优化点我们可以使用lru,缓存热数据；
新生代，nodejs默认给系统分配的是64M的内存，但是是采用scavenge算法的，所以我们能用的是32M的内存，如果说我们的系统频繁的产生小对象，这个空间很容易会被占满，导致频繁GC,这个很耗性能，GC甚至可以做到全部计算占比的30%左右，解决办法就是我们要增大这个空间，用max-semi-space-size
6、我们要合理使用stream 比如我们读取大文件的时候，不需要完全读入内存中，使用stream的方式一步步的读入，消费完之后在读，
pump，pipeline,比如我们用react,ssr我们用rendertoNodeStream
8、用node-clinic和automan去快速定位性能问题

